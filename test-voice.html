<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Feature Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            padding: 12px 24px;
            margin: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }
        .voice-btn {
            background: #3b82f6;
            color: white;
        }
        .voice-btn:hover {
            background: #2563eb;
        }
        .voice-btn.recording {
            background: #ef4444;
            animation: pulse 1s infinite;
        }
        .speak-btn {
            background: #10b981;
            color: white;
        }
        .speak-btn:hover {
            background: #059669;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        #transcript {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            min-height: 50px;
            border: 2px dashed #dee2e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé§ Voice Feature Test</h1>
        <p>This page tests the voice input and output functionality used in the AI Assistant.</p>
        
        <div id="status" class="status info">
            Ready to test voice features...
        </div>
        
        <h3>Voice Input Test</h3>
        <button id="voiceBtn" class="voice-btn">üé§ Start Voice Input</button>
        <div id="transcript">
            <em>Your speech will appear here...</em>
        </div>
        
        <h3>Voice Output Test</h3>
        <button id="speakBtn" class="speak-btn">üîä Test Voice Output</button>
        <button id="stopBtn" class="speak-btn">‚èπÔ∏è Stop Speaking</button>
        
        <h3>Browser Compatibility</h3>
        <div id="compatibility"></div>
    </div>

    <script>
        let recognition = null;
        let isRecording = false;
        
        // Check browser compatibility
        function checkCompatibility() {
            const compatDiv = document.getElementById('compatibility');
            let html = '<ul>';
            
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                html += '<li class="success">‚úÖ Speech Recognition: Supported</li>';
            } else {
                html += '<li class="error">‚ùå Speech Recognition: Not Supported</li>';
            }
            
            if ('speechSynthesis' in window) {
                html += '<li class="success">‚úÖ Speech Synthesis: Supported</li>';
            } else {
                html += '<li class="error">‚ùå Speech Synthesis: Not Supported</li>';
            }
            
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                html += '<li class="success">‚úÖ Microphone Access: Available</li>';
            } else {
                html += '<li class="error">‚ùå Microphone Access: Not Available</li>';
            }
            
            html += '</ul>';
            compatDiv.innerHTML = html;
        }
        
        // Initialize speech recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;
                recognition = new SpeechRecognition();
                
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onstart = () => {
                    updateStatus('üé§ Listening... Speak now!', 'info');
                    document.getElementById('voiceBtn').textContent = 'üõë Stop Recording';
                    document.getElementById('voiceBtn').classList.add('recording');
                    isRecording = true;
                };
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('transcript').innerHTML = `<strong>You said:</strong> "${transcript}"`;
                    updateStatus(`‚úÖ Successfully captured: "${transcript}"`, 'success');
                };
                
                recognition.onerror = (event) => {
                    let errorMsg = 'Speech recognition error: ' + event.error;
                    if (event.error === 'no-speech') {
                        errorMsg = 'No speech detected. Please try again.';
                    } else if (event.error === 'not-allowed') {
                        errorMsg = 'Microphone permission denied. Please allow access.';
                    }
                    updateStatus(errorMsg, 'error');
                };
                
                recognition.onend = () => {
                    document.getElementById('voiceBtn').textContent = 'üé§ Start Voice Input';
                    document.getElementById('voiceBtn').classList.remove('recording');
                    isRecording = false;
                    if (!document.getElementById('transcript').innerHTML.includes('You said:')) {
                        updateStatus('Voice input ended. Click the button to try again.', 'info');
                    }
                };
            }
        }
        
        // Update status message
        function updateStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        // Voice input button handler
        document.getElementById('voiceBtn').addEventListener('click', async () => {
            if (!recognition) {
                updateStatus('Speech recognition not supported in this browser', 'error');
                return;
            }
            
            if (isRecording) {
                recognition.stop();
                return;
            }
            
            try {
                // Request microphone permission
                await navigator.mediaDevices.getUserMedia({ audio: true });
                recognition.start();
            } catch (error) {
                updateStatus('Microphone access denied. Please allow microphone access.', 'error');
            }
        });
        
        // Voice output test
        document.getElementById('speakBtn').addEventListener('click', () => {
            if (!('speechSynthesis' in window)) {
                updateStatus('Speech synthesis not supported in this browser', 'error');
                return;
            }
            
            const text = "Hello! This is a test of the voice output feature. The AI Assistant can speak responses like this one. Voice input and output are now working perfectly!";
            
            speechSynthesis.cancel(); // Stop any current speech
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.85;
            utterance.pitch = 1.0;
            utterance.volume = 0.9;
            
            // Try to use a better voice
            const voices = speechSynthesis.getVoices();
            const preferredVoice = voices.find(voice => 
                voice.lang.startsWith('en') && 
                (voice.name.includes('Google') || voice.name.includes('Microsoft'))
            ) || voices.find(voice => voice.lang.startsWith('en'));
            
            if (preferredVoice) {
                utterance.voice = preferredVoice;
            }
            
            utterance.onstart = () => {
                updateStatus('üîä Speaking... Voice output is working!', 'success');
            };
            
            utterance.onend = () => {
                updateStatus('‚úÖ Voice output test completed successfully!', 'success');
            };
            
            utterance.onerror = () => {
                updateStatus('Voice output failed. Please try again.', 'error');
            };
            
            speechSynthesis.speak(utterance);
        });
        
        // Stop speaking button
        document.getElementById('stopBtn').addEventListener('click', () => {
            speechSynthesis.cancel();
            updateStatus('Voice output stopped.', 'info');
        });
        
        // Initialize everything
        checkCompatibility();
        initSpeechRecognition();
        
        // Load voices when available
        if ('speechSynthesis' in window) {
            speechSynthesis.addEventListener('voiceschanged', () => {
                console.log('Voices loaded:', speechSynthesis.getVoices().length);
            });
        }
    </script>
</body>
</html>